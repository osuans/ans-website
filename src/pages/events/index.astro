---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageHeader from "../../components/Sections/PageHeader.astro";
import EventCard from "../../components/UI/EventCard.astro";
import { getCollection } from "astro:content";
import { isFutureDate, isPastDate, groupEventsBySemester } from "../../utils/dateUtils";

// Get all events
const allEvents = await getCollection("events", ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Separate upcoming and past events
const upcomingEvents = allEvents.filter(event => isFutureDate(event.data.date))
                            .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime());

const pastEvents = allEvents.filter(event => isPastDate(event.data.date))
                        .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const groupedPastEvents = groupEventsBySemester(pastEvents);
---

<BaseLayout
  title="American Nuclear Society at OSU"
  description="Stay updated with upcoming events and activities at ANS at OSU."
>
  <PageHeader 
    title="Events" 
    subtitle="Join us for these upcoming activities"
    backgroundImage="/uploads/events.jpg"
  />
  
  <!-- Upcoming Events -->
  <section class="py-16">
    <div class="container">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Upcoming Events</h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          Mark your calendar and join us for these upcoming events
        </p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {upcomingEvents.map((event) => (
          <EventCard
            title={event.data.title}
            image={event.data.image}
            date={event.data.date}
            time={event.data.time}
            location={event.data.location}
            summary={event.data.summary}
            slug={event.slug}
            variant="upcoming"
          />
        ))}
      </div>
    </div>
  </section>
  
  <!-- Past Events -->
  <section class="py-16 bg-gray-50">
    <div class="container">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Past Events</h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          Browse our past events
        </p>
      </div>

      {Object.keys(groupedPastEvents).length > 0 ? (
        <div id="accordion">
          {Object.entries(groupedPastEvents).map(([semester, events]) => (
            <div class="accordion-item mb-2">
              <button class="accordion-button w-full text-left bg-white p-4 rounded-lg shadow-sm hover:bg-gray-100 focus:outline-none">
                <h3 class="text-xl font-bold">{semester}</h3>
              </button>
              <div class="accordion-content p-4 bg-white rounded-b-lg hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  {events.map((event) => (
                    <EventCard
                      title={event.data.title}
                      image={event.data.image}
                      date={event.data.date}
                      time={event.data.time}
                      location={event.data.location}
                      summary={event.data.summary}
                      slug={event.slug}
                      variant="past"
                      summaryLength={80}
                    />
                  ))}
                </div>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div class="text-center py-12 bg-white rounded-lg shadow-sm">
          <p class="text-gray-600">No past events to display.</p>
        </div>
      )}
    </div>
  </section>
  
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const accordion = document.getElementById('accordion');
    if (accordion) {
      const buttons = accordion.querySelectorAll('.accordion-button');
      buttons.forEach(function (button) {
        button.addEventListener('click', function () {
          const content = this.nextElementSibling;
          if (content) {
            content.classList.toggle('hidden');
          }
        });
      });
    }
  });
</script>
